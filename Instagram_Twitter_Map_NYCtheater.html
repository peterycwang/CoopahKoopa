<!DOCTYPE html>
<!-- Just added ticker stuff up to the javascript script links -->
<html>
  <head>
    <title>Your Source for NYC Theater</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
      <style>
     @import url(http://fonts.googleapis.com/css?family=Lobster|Kreon|Indie+Flower);
     p{
      background-color: #680000;
      color: yellow;
      font-family: Kreon;
      width: 75%;
      margin-left: 15%;
     }

      #container{
        float: left;
        width: 30%;
      }
      ul#ticker {
      width: 220px;
      height: 140px;
      overflow: hidden;
      }
       
      ul#ticker  li {
          font-weight: bold;
          margin-top: 20px;
          width: 200px;
          height: 99px;
          padding: 10px;
          border-bottom: 1px dashed #ccc;
          color: blue;
          background-color: #fff;
          background-color: rgba(255,255,255,0.5);
      }
       
      ul#ticker li a {
          color: #666;
      }
       
      ul#ticker li span {
          display: block;
          color: #06C;
      }
      html{
        background-size: cover;
        background-image: url("http://chiangmai.thaivisa.com/wp-content/uploads/movie-theaters-and-venues.jpg");
        background-repeat: no-repeat;
      }
      html, body, #map {
        height: 100%;
        margin: 0px;
        padding: 0px;
      }

      #map{
        width: 70%;
        float:left;
      }
      .fancy{
        text-align: center;
        font-family: 'Lobster', cursive;
        color: cyan;
        background-color: blue;
        display:block;
        width: 30%;
        margin-left: 35%;

      }
      .silly{
        height: 10%;
      }
      .silly2{
        height: 10%;
        float: right;
      }

      </style>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script> <!--JQUERY SCRIPT -->
    <!--Ticker script, seems to work without? -->
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script> <!--GOOGLE MAPS SCRIPT -->
    <script> 

      //START OF DRAW FUNCTION

      var draw = function(id, mapOptions, positions) {

      var map = new google.maps.Map(document.getElementById(id), mapOptions);

      var myLatlng = new google.maps.LatLng(40.7293, -73.9906);

      //set up some empty arrays to use
      var markers = [];
      var infoWindows = [];
      var popUps = [];

      //create all of the markers on the map
      for (i in positions) {

      // Adding a marker to the map
        markers[i] = new google.maps.Marker({
          position: positions[i].map,
          map: map,
          title: positions[i].title,
          icon: positions[i].icon, //url to images
          animation: positions[i].animation
          });
        
      }

       //loop through the markers, and add pop-up windows to them for links
       for (i in markers) {

      //create a template with two placeholder to replace
      var popUpTemplate = '<div class="content"><a href="{{link}}">{{content}}</a></div>';

      //replace the content placeholder
      popUps[i] = popUpTemplate.replace('{{content}}', positions[i].name);

      //replace the link placeholder
      popUps[i] = popUps[i].replace('{{link}}', positions[i].link);

      //create a new info window
      infoWindows[i] = new google.maps.InfoWindow({
      //the contents is the string-replaced template we created within this loop
      content:popUps[i],
      maxWidth:200
      });

      //when a marker is clicked on
      google.maps.event.addListener(markers[i], 'click', function(innerKey) {
      return function() {
          //comment out the for loop persist each info window
          for (j in markers) {
            infoWindows[j].close(map, markers[j]);
          }

          //open the infoWindow related to the marker clicked on
          infoWindows[innerKey].open(map, markers[innerKey]);
      }
    }(i));
  }
} //end of the initialize function

    //END OF DRAW FUNCTION
    //Start HighCharts drawChart Function 
    var drawChart = function(trend){ 
                
    // Radialize the colors
    Highcharts.getOptions().colors = Highcharts.map(Highcharts.getOptions().colors, function (color) {
        return {
            radialGradient: { cx: 0.5, cy: 0.3, r: 0.7 },
            stops: [
                [0, color],
                [1, Highcharts.Color(color).brighten(-0.3).get('rgb')] // darken
            ]
        };
    });

    // Build the chart
    $('#container').highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false
        },
        title: {
            text: 'Proportion of Theater Posts: Twitter vs. Instagram'
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                    style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                    },
                    connectorColor: 'silver'
                }
            }
        },
        series: [{
            type: 'pie',
            name: 'Proportion of Posts',
            data: trend
        }]
    });
  };
    // End High charts drawChart function

    //START OF INSTAGRAM AND MAP ACTUAL CODE
      var trend = []; 

			$(document).ready(function(){


        $.getJSON("http://cooper-union-instagram-proxy.herokuapp.com/search/tag/nyctheater?count=50", function(response){

				  console.log(response.length);  //number of entries
 
          var mapOptions = {
          zoom: 11,
          center: new google.maps.LatLng(40.77, -73.9906) //centered at cooper, but zoomed to manhattan
          };
          var positions = [];


            for(var i=0; i<response.length; i++) {
              if(response[i].location != null) {
                var latitude = response[i].location.latitude;
                var longitude = response[i].location.longitude;
                if(response[i].location.name!= null){
                  var name = response[i].location.name;
                } else{
                  var name  = response[i].caption.text;
                };

                positions.push(
                {
                  'title':response[i].caption.text,
                  'map': new google.maps.LatLng(latitude, longitude),
                  'name': name,
                  'link': response[i].link, // link to instagram post
                  'icon': {   // make it an object rather than just a URL so can edit size.
                      "url": response[i].images.thumbnail.url,
                      "size": new google.maps.Size(50,50),
                      "origin": new google.maps.Point(20,20) // sets so image more centered
                          },
                  'animation': google.maps.Animation.DROP,
                });
                 
              };
            };
            trend.push(['Instagramcracker', response.length]);

            // Start Twitter GetJson

            $.getJSON("http://cooper-union-search-proxy.herokuapp.com/twitter/search/nyctheater?since_id=539467092236308470&count=50 ", function(response){
              console.log(response.statuses.length);
              var tickerentries = [];
              for(var i=0; i<response.statuses.length; i++){
                tickerentries.push(response.statuses[i].text);
               
              };
                  var combo = "<ul id= 'ticker'>";
                  for(var i=0; i<tickerentries.length; i++){
                  combo = combo + "<li><span>" + tickerentries[i] + "</span></li>";
                  };
                  combo = combo + "</ul>";
                  $("body").append(combo);

               var ticker = function()
                {
                    setTimeout(function(){
                        $('#ticker li:first').animate( {marginTop: '-120px'}, 800, function()
                        {
                            $(this).detach().appendTo('ul#ticker').removeAttr('style');
                        });
                        ticker();
                    }, 5000); // amount of time per post, 4.1 sec.
                };
                ticker();

               trend.push(['Twitter', tickerentries.length]);
               console.log(trend);
               drawChart(trend);
          draw('map', mapOptions, positions);  

        }); // closes twitter getJSON
       }); //closes instagram getJSON

     }); //closes readyfunction
    
    //END OF INSTAGRAM AND MAP

</script>
</head>
<body>
  <img class = "silly" src = "http://paulabrown.net/drama-masks-logo-218.png" />
  <img class = "silly2" src = "http://paulabrown.net/drama-masks-logo-218.png" />
  <h1 class = "fancy"> Theatre Central </h1>

  <p> This page is devoted to avid theater-goers in New York City. Rather than using the NYCtheater site, I thought this would be useful, as we get the shows that people are happy enough to tweet about (social media perspective) and react to rather than just getting the shows from a list of discount tickets on a site like theatermania.com, and we get location info of where people tweeted about them. Recent responses only give you theater shows you can go to. Crowdsourcing and individual responses are utilized. </p>
  <p> The run-down: Included are a map of recent instagram theater posts. 1) Observe marker location on map to see if distance from you is desirable. 2) Hover over icons to see text-content of post. 3) Click on post to see theater name if available. For added fun, see which social media network has the craziest (or more active) NYC theater fans! </p>
    <div id="map"></div>
    <div id="container" style="min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto"></div>
</body>
</html>

