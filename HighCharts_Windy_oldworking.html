<!DOCTYPE html>
<html>
<head>
 <script src="http://code.jquery.com/jquery-latest.min.js"></script>
 <script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/highcharts-more.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>   

<script>
    $(document).ready(function(){
        //highCharts function
            var drawChart = function(bubbledata) {  // accepts parameter bubbledata, which must be an array of 3-element arrays
                $('#container').highcharts({

                    chart: {
                        type: 'bubble',
                        zoomType: 'xy'
                    },

                    title: {
                        text: 'Windspeed and Realfeel'
                    },

                    xAxis: {
                    title: {
                        text: 'Temperature (deg F)'
                    }},

                    yAxis: {
                    title: {
                        text: 'Realfeel Temperature (deg F)'
                    }},

                    series: [
                        {  // data accepts arrays of arrays of 3 objects.
                            name: 'Windspeed',
                            data: bubbledata    // only plotting one series
                        }, 

                        {
                            type: 'line',
                            name: 'Reference Line',
                            data: [[40, 40], [80, 80]], // slope 1, so 1 to 1 correspondence of Temp and Realfeel Temp
                            marker: {
                                enabled: false
                            },
                            states: {
                                hover: {
                                    lineWidth: 0
                                }
                            },
                            enableMouseTracking: false
                        }
                     ]
                });
            };
        // array of websites, cities across the U.S.
        var cities = ["NY/Manhattan", "CA/Los_Angeles", "IL/Chicago", "TX/Houston", "PA/Philadelphia", "AZ/Phoenix", "FL/Jacksonville", "IN/Indianapolis", "OH/Columbus", "NC/Charlotte", "MI/Detroit", "TN/Memphis", "MA/Boston", "WA/Seattle", "DC/Washington"];
        var cityURLs = [];

        for(var i=0; i<= 14; i++){  //creating an array of the city urls to use with getJSON
        var tempURL = "http://cooper-union-weather-proxy.herokuapp.com/weather/" + cities[i];
        cityURLs.push(tempURL);
        };
        
        var positions = [];
        var winddata = [];
        var counter = 0;
        for(var i=0; i<=14; i++){
            $.getJSON(cityURLs[i], function(response){   // accessing api data through response var object
                positions[i]= [];

                realTemp = response.current_observation.temp_f;
                feelsTemp = Number(response.current_observation.feelslike_f);
                windSpeed = response.current_observation.wind_mph;

                // console.log(windSpeed + " " + realTemp + " " + feelsTemp);    // using "feelslike" so windchill temps without wind still have existing temperatures rather than NA
                positions[i].push(realTemp);
                positions[i].push(feelsTemp);
                positions[i].push(windSpeed);
                    winddata.push(positions[i]);    // push on an array each time as the ith element of the larger array
                    

                if(counter === 14) {    // end stuff when data is all compiled
                    console.log("hi");
                    console.log(positions[i]);
                    console.log(winddata);
                    drawChart(winddata);
                    //drawChart(positions);

                }; // closes if loop
                counter = counter +1; 
            });     // closes getJSON


        }; // closes for loop with getJSONs 


        // define drawChart inside readyfunction and script tag


        // end outside code
        });
    </script>

</head>

<div id="container" style="height: 400px; min-width: 310px; max-width: 600px; margin: 0 auto"></div>

</html>